var DomToPip=function(b){"use strict";var _=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(f){c(f)}}function a(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};const L="application/font-woff",I="image/jpeg",B={woff:L,woff2:L,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:I,jpeg:I,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function z(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}function y(t){const e=z(t).toLowerCase();return B[e]||""}function G(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),e&&(r.href=e),i.href=t,i.href}function E(t){return t.search(/^(data:)/)!==-1}function v(t,e){return`data:${e};base64,${t}`}function X(t){return t.split(/,/)[1]}const q=function(){let e=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${n()}${e}`)}();function g(t){const e=[];for(let n=0,r=t.length;n<r;n+=1)e.push(t[n]);return e}function S(t,e){const n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}function K(t){const e=S(t,"border-left-width"),n=S(t,"border-right-width");return t.clientWidth+e+n}function J(t){const e=S(t,"border-top-width"),n=S(t,"border-bottom-width");return t.clientHeight+e+n}function Q(){let t,e;try{e=process}catch{}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}function C(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=t})}function Y(t){return _(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(t)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)})}function Z(t,e,n){return _(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(t),Y(i)})}const T={};function N(t){let e=t.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(e)&&(e=e.replace(/.*\//,"")),e}function R(t,e){const n=N(t);if(T[n]!=null)return T[n];e.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+new Date().getTime());const r=o=>{let c="";if(e.imagePlaceholder){const a=e.imagePlaceholder.split(/,/);a&&a[1]&&(c=a[1])}let l=`Failed to fetch resource: ${t}`;return o&&(l=typeof o=="string"?o:o.message),l&&console.error(l),{blob:c,contentType:""}},i=window.fetch(t).then(o=>o.blob().then(c=>({blob:c,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:c})=>new Promise((l,a)=>{const u=new FileReader;u.onloadend=()=>l({contentType:c,blob:u.result}),u.onerror=a,u.readAsDataURL(o)})).then(({blob:o,contentType:c})=>({contentType:c,blob:X(o)})).catch(r);return T[n]=i,i}function tt(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}function et(t){return g(t).map(e=>{const n=t.getPropertyValue(e),r=t.getPropertyPriority(e);return`${e}: ${n}${r?" !important":""};`}).join(" ")}function nt(t,e,n){const r=`.${t}:${e}`,i=n.cssText?tt(n):et(n);return document.createTextNode(`${r}{${i}}`)}function U(t,e,n){const r=window.getComputedStyle(t,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=q();try{e.className=`${e.className} ${o}`}catch{return}const c=document.createElement("style");c.appendChild(nt(o,n,r)),e.appendChild(c)}function rt(t,e){U(t,e,":before"),U(t,e,":after")}var p=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(f){c(f)}}function a(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};function it(t){return p(this,void 0,void 0,function*(){const e=t.toDataURL();return e==="data:,"?Promise.resolve(t.cloneNode(!1)):C(e)})}function ot(t,e){return p(this,void 0,void 0,function*(){return Promise.resolve(t.poster).then(n=>R(n,e)).then(n=>v(n.blob,y(t.poster)||n.contentType)).then(n=>C(n))})}function ct(t,e){return p(this,void 0,void 0,function*(){return t instanceof HTMLCanvasElement?it(t):t instanceof HTMLVideoElement&&t.poster?ot(t,e):Promise.resolve(t.cloneNode(!1))})}const st=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SLOT";function ut(t,e,n){var r;return p(this,void 0,void 0,function*(){const i=st(t)&&t.assignedNodes?g(t.assignedNodes()):g(((r=t.shadowRoot)!==null&&r!==void 0?r:t).childNodes);return i.length===0||t instanceof HTMLVideoElement?Promise.resolve(e):i.reduce((o,c)=>o.then(()=>k(c,n)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()).then(()=>e)})}function lt(t,e){const n=window.getComputedStyle(t),r=e.style;!r||(n.cssText?r.cssText=n.cssText:g(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function at(t,e){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function ft(t,e){return p(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve().then(()=>lt(t,e)).then(()=>rt(t,e)).then(()=>at(t,e)).then(()=>e):Promise.resolve(e)})}function k(t,e,n){return p(this,void 0,void 0,function*(){return!n&&e.filter&&!e.filter(t)?Promise.resolve(null):Promise.resolve(t).then(r=>ct(r,e)).then(r=>ut(t,r,e)).then(r=>ft(t,r))})}var ht=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(f){c(f)}}function a(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};const F=/url\((['"]?)([^'"]+?)\1\)/g,dt=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,mt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function gt(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function pt(t){const e=[];return t.replace(F,(n,r,i)=>(e.push(i),n)),e.filter(n=>!E(n))}function wt(t,e,n,r,i){const o=n?G(e,n):e;return Promise.resolve(o).then(c=>i?i(c):R(c,r)).then(c=>typeof c=="string"?v(c,y(e)):v(c.blob,y(e)||c.contentType)).then(c=>t.replace(gt(e),`$1${c}$3`)).then(c=>c,()=>o)}function bt(t,{preferredFontFormat:e}){return e?t.replace(mt,n=>{for(;;){const[r,,i]=dt.exec(n)||[];if(!i)return"";if(i===e)return`src: ${r};`}}):t}function M(t){return t.search(F)!==-1}function A(t,e,n){return ht(this,void 0,void 0,function*(){if(!M(t))return Promise.resolve(t);const r=bt(t,n);return Promise.resolve(r).then(pt).then(i=>i.reduce((o,c)=>o.then(l=>wt(l,c,e,n)),Promise.resolve(r)))})}var x=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(f){c(f)}}function a(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};function yt(t,e){var n;return x(this,void 0,void 0,function*(){const r=(n=t.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>A(i,null,e)).then(i=>(t.style.setProperty("background",i,t.style.getPropertyPriority("background")),t)):Promise.resolve(t)})}function vt(t,e){return x(this,void 0,void 0,function*(){if(!(t instanceof HTMLImageElement&&!E(t.src))&&!(t instanceof SVGImageElement&&!E(t.href.baseVal)))return Promise.resolve(t);const n=t instanceof HTMLImageElement?t.src:t.href.baseVal;return Promise.resolve(n).then(r=>R(r,e)).then(r=>v(r.blob,y(n)||r.contentType)).then(r=>new Promise((i,o)=>{t.onload=i,t.onerror=o,t instanceof HTMLImageElement?(t.srcset="",t.src=r):t.href.baseVal=r})).then(()=>t,()=>t)})}function St(t,e){return x(this,void 0,void 0,function*(){const r=g(t.childNodes).map(i=>D(i,e));return Promise.all(r).then(()=>t)})}function D(t,e){return x(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve(t).then(n=>yt(n,e)).then(n=>vt(n,e)).then(n=>St(n,e)):Promise.resolve(t)})}function xt(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const r=e.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),t}var w=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(f){c(f)}}function a(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};const V={};function H(t){const e=V[t];if(e!=null)return e;const n=window.fetch(t).then(r=>({url:t,cssText:r.text()}));return V[t]=n,n}function O(t){return w(this,void 0,void 0,function*(){return t.cssText.then(e=>{let n=e;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(c=>{let l=c.replace(r,"$1");return l.startsWith("https://")||(l=new URL(l,t.url).href),window.fetch(l).then(a=>a.blob()).then(a=>new Promise((u,s)=>{const f=new FileReader;f.onloadend=()=>{n=n.replace(c,`url(${f.result})`),u([c,f.result])},f.onerror=s,f.readAsDataURL(a)}))});return Promise.all(o).then(()=>n)})})}function W(t){if(t==null)return[];const e=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=t.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const a=i.exec(r);if(a===null)break;e.push(a[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,c="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(c,"gi");for(;;){let a=o.exec(r);if(a===null){if(a=l.exec(r),a===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;e.push(a[0])}return e}function Et(t){return w(this,void 0,void 0,function*(){const e=[],n=[];return t.forEach(r=>{if("cssRules"in r)try{g(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let c=o+1;const l=i.href,a=H(l).then(u=>u?O(u):"").then(u=>W(u).forEach(s=>{try{r.insertRule(s,s.startsWith("@import")?c+=1:r.cssRules.length)}catch(f){console.error("Error inserting rule from remote css",{rule:s,error:f})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(a)}})}catch(i){const o=t.find(c=>c.href==null)||document.styleSheets[0];r.href!=null&&n.push(H(r.href).then(c=>c?O(c):"").then(c=>W(c).forEach(l=>{o.insertRule(l,r.cssRules.length)})).catch(c=>{console.error("Error loading remote stylesheet",c.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(t.forEach(r=>{if("cssRules"in r)try{g(r.cssRules).forEach(i=>{e.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),e))})}function Ct(t){return t.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>M(e.style.getPropertyValue("src")))}function Tt(t){return w(this,void 0,void 0,function*(){return new Promise((e,n)=>{t.ownerDocument==null&&n(new Error("Provided element is not within a Document")),e(g(t.ownerDocument.styleSheets))}).then(e=>Et(e)).then(Ct)})}function Rt(t,e){return w(this,void 0,void 0,function*(){return Tt(t).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return A(r.cssText,i,e)}))).then(n=>n.join(`
`))})}function Pt(t,e){return w(this,void 0,void 0,function*(){return(e.fontEmbedCSS!=null?Promise.resolve(e.fontEmbedCSS):Rt(t,e)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),t})})}var P=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(f){c(f)}}function a(s){try{u(r.throw(s))}catch(f){c(f)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};function j(t,e={}){const n=e.width||K(t),r=e.height||J(t);return{width:n,height:r}}function $t(t,e={}){return P(this,void 0,void 0,function*(){const{width:n,height:r}=j(t,e);return Promise.resolve(t).then(i=>k(i,e,!0)).then(i=>Pt(i,e)).then(i=>D(i,e)).then(i=>xt(i,e)).then(i=>Z(i,n,r))})}const h=16384;function _t(t){(t.width>h||t.height>h)&&(t.width>h&&t.height>h?t.width>t.height?(t.height*=h/t.width,t.width=h):(t.width*=h/t.height,t.height=h):t.width>h?(t.height*=h/t.width,t.width=h):(t.width*=h/t.height,t.height=h))}function Lt(t,e={}){return P(this,void 0,void 0,function*(){return $t(t,e).then(C).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=e.pixelRatio||Q(),{width:c,height:l}=j(t,e),a=e.canvasWidth||c,u=e.canvasHeight||l;return r.width=a*o,r.height=u*o,e.skipAutoScale||_t(r),r.style.width=`${a}`,r.style.height=`${u}`,e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function It(t,e={}){return P(this,void 0,void 0,function*(){return Lt(t,e).then(n=>n.toDataURL())})}let m,d,$;function Ut(){m=document.createElement("video"),m.controls=!0,m.autoplay=!0,m.style.position="absolute",m.style.width="20px",document.body.appendChild(m),d=document.createElement("button"),d.textContent="Enter PIP",d.onclick=()=>{m.requestPictureInPicture()},d.style.zIndex="100",d.style.position="absolute",d.style.top="10px",d.style.left="10px",d.style.width="100px",d.style.background="orange",document.body.appendChild(d),$=document.createElement("canvas")}function kt(){Ut();const t=$.captureStream(1),e=new MediaRecorder(t);e.ondataavailable=Ft;let n;setInterval(()=>{It(document.body).then(r=>{e.start();const i=new Image;i.src=r;const o=$.getContext("2d");o.width=i.width,o.height=i.height,o.drawImage(i,0,0),clearTimeout(n),n=setTimeout(()=>{e.stop()},500)})},3e3)}function Ft(t){console.log("Encoded");const e=new Blob([t.data]),n=URL.createObjectURL(e);m.src=n,m.onended=function(){URL.revokeObjectURL(n)}}return b.start=kt,Object.defineProperty(b,"__esModule",{value:!0}),b[Symbol.toStringTag]="Module",b}({});
