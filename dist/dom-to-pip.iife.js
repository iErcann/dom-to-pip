var DomToPip=function(){"use strict";var $=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(h){c(h)}}function a(s){try{u(r.throw(s))}catch(h){c(h)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};const _="application/font-woff",L="image/jpeg",j={woff:_,woff2:_,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:L,jpeg:L,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function B(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}function b(t){const e=B(t).toLowerCase();return j[e]||""}function z(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),e&&(r.href=e),i.href=t,i.href}function S(t){return t.search(/^(data:)/)!==-1}function y(t,e){return`data:${e};base64,${t}`}function G(t){return t.split(/,/)[1]}const X=function(){let e=0;const n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${n()}${e}`)}();function m(t){const e=[];for(let n=0,r=t.length;n<r;n+=1)e.push(t[n]);return e}function v(t,e){const n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}function q(t){const e=v(t,"border-left-width"),n=v(t,"border-right-width");return t.clientWidth+e+n}function K(t){const e=v(t,"border-top-width"),n=v(t,"border-bottom-width");return t.clientHeight+e+n}function J(){let t,e;try{e=process}catch{}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}function E(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=n,r.crossOrigin="anonymous",r.decoding="sync",r.src=t})}function Q(t){return $(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(t)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)})}function Y(t,e,n){return $(this,void 0,void 0,function*(){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),o=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("externalResourcesRequired","true"),i.appendChild(o),o.appendChild(t),Q(i)})}const C={};function Z(t){let e=t.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(e)&&(e=e.replace(/.*\//,"")),e}function R(t,e){const n=Z(t);if(C[n]!=null)return C[n];e.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+new Date().getTime());const r=o=>{let c="";if(e.imagePlaceholder){const a=e.imagePlaceholder.split(/,/);a&&a[1]&&(c=a[1])}let l=`Failed to fetch resource: ${t}`;return o&&(l=typeof o=="string"?o:o.message),l&&console.error(l),{blob:c,contentType:""}},i=window.fetch(t).then(o=>o.blob().then(c=>({blob:c,contentType:o.headers.get("Content-Type")||""}))).then(({blob:o,contentType:c})=>new Promise((l,a)=>{const u=new FileReader;u.onloadend=()=>l({contentType:c,blob:u.result}),u.onerror=a,u.readAsDataURL(o)})).then(({blob:o,contentType:c})=>({contentType:c,blob:G(o)})).catch(r);return C[n]=i,i}function N(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}function tt(t){return m(t).map(e=>{const n=t.getPropertyValue(e),r=t.getPropertyPriority(e);return`${e}: ${n}${r?" !important":""};`}).join(" ")}function et(t,e,n){const r=`.${t}:${e}`,i=n.cssText?N(n):tt(n);return document.createTextNode(`${r}{${i}}`)}function I(t,e,n){const r=window.getComputedStyle(t,n),i=r.getPropertyValue("content");if(i===""||i==="none")return;const o=X();try{e.className=`${e.className} ${o}`}catch{return}const c=document.createElement("style");c.appendChild(et(o,n,r)),e.appendChild(c)}function nt(t,e){I(t,e,":before"),I(t,e,":after")}var p=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(h){c(h)}}function a(s){try{u(r.throw(s))}catch(h){c(h)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};function rt(t){return p(this,void 0,void 0,function*(){const e=t.toDataURL();return e==="data:,"?Promise.resolve(t.cloneNode(!1)):E(e)})}function it(t,e){return p(this,void 0,void 0,function*(){return Promise.resolve(t.poster).then(n=>R(n,e)).then(n=>y(n.blob,b(t.poster)||n.contentType)).then(n=>E(n))})}function ot(t,e){return p(this,void 0,void 0,function*(){return t instanceof HTMLCanvasElement?rt(t):t instanceof HTMLVideoElement&&t.poster?it(t,e):Promise.resolve(t.cloneNode(!1))})}const ct=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SLOT";function st(t,e,n){var r;return p(this,void 0,void 0,function*(){const i=ct(t)&&t.assignedNodes?m(t.assignedNodes()):m(((r=t.shadowRoot)!==null&&r!==void 0?r:t).childNodes);return i.length===0||t instanceof HTMLVideoElement?Promise.resolve(e):i.reduce((o,c)=>o.then(()=>U(c,n)).then(l=>{l&&e.appendChild(l)}),Promise.resolve()).then(()=>e)})}function ut(t,e){const n=window.getComputedStyle(t),r=e.style;!r||(n.cssText?r.cssText=n.cssText:m(n).forEach(i=>{r.setProperty(i,n.getPropertyValue(i),n.getPropertyPriority(i))}))}function lt(t,e){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function at(t,e){return p(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve().then(()=>ut(t,e)).then(()=>nt(t,e)).then(()=>lt(t,e)).then(()=>e):Promise.resolve(e)})}function U(t,e,n){return p(this,void 0,void 0,function*(){return!n&&e.filter&&!e.filter(t)?Promise.resolve(null):Promise.resolve(t).then(r=>ot(r,e)).then(r=>st(t,r,e)).then(r=>at(t,r))})}var ht=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(h){c(h)}}function a(s){try{u(r.throw(s))}catch(h){c(h)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};const k=/url\((['"]?)([^'"]+?)\1\)/g,ft=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,dt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function mt(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function gt(t){const e=[];return t.replace(k,(n,r,i)=>(e.push(i),n)),e.filter(n=>!S(n))}function pt(t,e,n,r,i){const o=n?z(e,n):e;return Promise.resolve(o).then(c=>i?i(c):R(c,r)).then(c=>typeof c=="string"?y(c,b(e)):y(c.blob,b(e)||c.contentType)).then(c=>t.replace(mt(e),`$1${c}$3`)).then(c=>c,()=>o)}function wt(t,{preferredFontFormat:e}){return e?t.replace(dt,n=>{for(;;){const[r,,i]=ft.exec(n)||[];if(!i)return"";if(i===e)return`src: ${r};`}}):t}function F(t){return t.search(k)!==-1}function A(t,e,n){return ht(this,void 0,void 0,function*(){if(!F(t))return Promise.resolve(t);const r=wt(t,n);return Promise.resolve(r).then(gt).then(i=>i.reduce((o,c)=>o.then(l=>pt(l,c,e,n)),Promise.resolve(r)))})}var x=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(h){c(h)}}function a(s){try{u(r.throw(s))}catch(h){c(h)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};function bt(t,e){var n;return x(this,void 0,void 0,function*(){const r=(n=t.style)===null||n===void 0?void 0:n.getPropertyValue("background");return r?Promise.resolve(r).then(i=>A(i,null,e)).then(i=>(t.style.setProperty("background",i,t.style.getPropertyPriority("background")),t)):Promise.resolve(t)})}function yt(t,e){return x(this,void 0,void 0,function*(){if(!(t instanceof HTMLImageElement&&!S(t.src))&&!(t instanceof SVGImageElement&&!S(t.href.baseVal)))return Promise.resolve(t);const n=t instanceof HTMLImageElement?t.src:t.href.baseVal;return Promise.resolve(n).then(r=>R(r,e)).then(r=>y(r.blob,b(n)||r.contentType)).then(r=>new Promise((i,o)=>{t.onload=i,t.onerror=o,t instanceof HTMLImageElement?(t.srcset="",t.src=r):t.href.baseVal=r})).then(()=>t,()=>t)})}function vt(t,e){return x(this,void 0,void 0,function*(){const r=m(t.childNodes).map(i=>D(i,e));return Promise.all(r).then(()=>t)})}function D(t,e){return x(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve(t).then(n=>bt(n,e)).then(n=>yt(n,e)).then(n=>vt(n,e)):Promise.resolve(t)})}function xt(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const r=e.style;return r!=null&&Object.keys(r).forEach(i=>{n[i]=r[i]}),t}var w=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(h){c(h)}}function a(s){try{u(r.throw(s))}catch(h){c(h)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};const M={};function V(t){const e=M[t];if(e!=null)return e;const n=window.fetch(t).then(r=>({url:t,cssText:r.text()}));return M[t]=n,n}function H(t){return w(this,void 0,void 0,function*(){return t.cssText.then(e=>{let n=e;const r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map(c=>{let l=c.replace(r,"$1");return l.startsWith("https://")||(l=new URL(l,t.url).href),window.fetch(l).then(a=>a.blob()).then(a=>new Promise((u,s)=>{const h=new FileReader;h.onloadend=()=>{n=n.replace(c,`url(${h.result})`),u([c,h.result])},h.onerror=s,h.readAsDataURL(a)}))});return Promise.all(o).then(()=>n)})})}function O(t){if(t==null)return[];const e=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=t.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const a=i.exec(r);if(a===null)break;e.push(a[0])}r=r.replace(i,"");const o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,c="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(c,"gi");for(;;){let a=o.exec(r);if(a===null){if(a=l.exec(r),a===null)break;o.lastIndex=l.lastIndex}else l.lastIndex=o.lastIndex;e.push(a[0])}return e}function St(t){return w(this,void 0,void 0,function*(){const e=[],n=[];return t.forEach(r=>{if("cssRules"in r)try{m(r.cssRules).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let c=o+1;const l=i.href,a=V(l).then(u=>u?H(u):"").then(u=>O(u).forEach(s=>{try{r.insertRule(s,s.startsWith("@import")?c+=1:r.cssRules.length)}catch(h){console.error("Error inserting rule from remote css",{rule:s,error:h})}})).catch(u=>{console.error("Error loading remote css",u.toString())});n.push(a)}})}catch(i){const o=t.find(c=>c.href==null)||document.styleSheets[0];r.href!=null&&n.push(V(r.href).then(c=>c?H(c):"").then(c=>O(c).forEach(l=>{o.insertRule(l,r.cssRules.length)})).catch(c=>{console.error("Error loading remote stylesheet",c.toString())})),console.error("Error inlining remote css file",i.toString())}}),Promise.all(n).then(()=>(t.forEach(r=>{if("cssRules"in r)try{m(r.cssRules).forEach(i=>{e.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i.toString())}}),e))})}function Et(t){return t.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>F(e.style.getPropertyValue("src")))}function Ct(t){return w(this,void 0,void 0,function*(){return new Promise((e,n)=>{t.ownerDocument==null&&n(new Error("Provided element is not within a Document")),e(m(t.ownerDocument.styleSheets))}).then(e=>St(e)).then(Et)})}function Rt(t,e){return w(this,void 0,void 0,function*(){return Ct(t).then(n=>Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return A(r.cssText,i,e)}))).then(n=>n.join(`
`))})}function Tt(t,e){return w(this,void 0,void 0,function*(){return(e.fontEmbedCSS!=null?Promise.resolve(e.fontEmbedCSS):Rt(t,e)).then(n=>{const r=document.createElement("style"),i=document.createTextNode(n);return r.appendChild(i),t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),t})})}var T=globalThis&&globalThis.__awaiter||function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(s){try{u(r.next(s))}catch(h){c(h)}}function a(s){try{u(r.throw(s))}catch(h){c(h)}}function u(s){s.done?o(s.value):i(s.value).then(l,a)}u((r=r.apply(t,e||[])).next())})};function W(t,e={}){const n=e.width||q(t),r=e.height||K(t);return{width:n,height:r}}function Pt(t,e={}){return T(this,void 0,void 0,function*(){const{width:n,height:r}=W(t,e);return Promise.resolve(t).then(i=>U(i,e,!0)).then(i=>Tt(i,e)).then(i=>D(i,e)).then(i=>xt(i,e)).then(i=>Y(i,n,r))})}const f=16384;function $t(t){(t.width>f||t.height>f)&&(t.width>f&&t.height>f?t.width>t.height?(t.height*=f/t.width,t.width=f):(t.width*=f/t.height,t.height=f):t.width>f?(t.height*=f/t.width,t.width=f):(t.width*=f/t.height,t.height=f))}function _t(t,e={}){return T(this,void 0,void 0,function*(){return Pt(t,e).then(E).then(n=>{const r=document.createElement("canvas"),i=r.getContext("2d"),o=e.pixelRatio||J(),{width:c,height:l}=W(t,e),a=e.canvasWidth||c,u=e.canvasHeight||l;return r.width=a*o,r.height=u*o,e.skipAutoScale||$t(r),r.style.width=`${a}`,r.style.height=`${u}`,e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(0,0,r.width,r.height)),i.drawImage(n,0,0,r.width,r.height),r})})}function Lt(t,e={}){return T(this,void 0,void 0,function*(){return _t(t,e).then(n=>n.toDataURL())})}let g,d,P;function It(){g=document.createElement("video"),document.body.appendChild(g),d=document.createElement("button"),d.textContent="Enter PIP",d.onclick=()=>{g.requestPictureInPicture()},d.style.zIndex="100",d.style.position="absolute",d.style.top="10px",d.style.left="10px",d.style.width="100px",d.style.background="orange",document.body.appendChild(d),P=document.createElement("canvas")}function Ut(){It();const t=P.captureStream(1),e=new MediaRecorder(t);e.ondataavailable=kt;let n;setInterval(()=>{Lt(document.body).then(r=>{e.start();const i=new Image;i.src=r;const o=P.getContext("2d");o.width=i.width,o.height=i.height,o.drawImage(i,0,0),clearTimeout(n),n=setTimeout(()=>{e.stop()},500)})},1e3)}function kt(t){console.log("Encoded");const e=new Blob([t.data]),n=URL.createObjectURL(e);g.controls=!0,g.style.position="absolute",g.style.width="20px",g.src=n,g.onended=function(){URL.revokeObjectURL(n)}}return Ut}();
